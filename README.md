# 🐺 Agent and Wolf

基于轻小说《狼与香辛料》的智能对话系统，使用 LangChain Agent、RAG（检索增强生成）和多工具集成技术实现。

## 📖 项目简介

本项目以支仓冻砂老师的经典轻小说《狼与香辛料》为基础，实现了一个能够完美扮演女主人公贤狼赫萝的 AI 智能体。通过 LangChain 的 ReAct Agent 框架，赫萝不仅能够基于小说内容回答问题，还能查询实时信息、获取当前时间，展现出真正的"智慧"。

### ✨ 核心特色

- **🎭 完美角色扮演**：保持赫萝独特的说话方式（"奴家"、"咱"、"汝"、"呗"）和性格特征
- **🧠 智能工具调用**：集成时间查询、维基百科搜索、小说内容检索等多种工具
- **💬 多轮对话记忆**：基于 Google Firestore 的持久化聊天历史
- **🔍 智能检索系统**：从小说文本中检索相关信息，提供准确的故事背景

### 🛠️ 技术架构

- **LangChain ReAct Agent**: 智能体框架，支持思考-行动-观察循环
- **Google Gemini 1.5**: 强大的大语言模型用于对话生成和推理
- **Chroma Vector DB**: 高效的向量数据库用于语义搜索
- **HuggingFace Embeddings**: Qwen/Qwen3-Embedding-0.6B 中文文本嵌入
- **Google Firestore**: 云端聊天历史持久化存储
- **Wikipedia API**: 实时百科知识查询

## 🚀 快速开始

### 环境要求

- Python 3.13+
- Google AI Studio API Key
- Google Cloud Project (可选，用于聊天历史存储)

### 安装依赖

```bash
# 创建虚拟环境（推荐）
conda create -n agent-wolf python=3.13
conda activate agent-wolf

# 安装依赖
pip install python-dotenv langchain langchain-community langchain-huggingface 
pip install langchain-chroma langchain-google-genai langchain-google-firestore
pip install sentence-transformers wikipedia google-cloud-firestore
```

### 环境配置

1. 创建 `.env` 文件：
```env
# 必需：Google AI API Key
GOOGLE_API_KEY=your_google_ai_api_key_here

# 可选：Google Cloud 配置
GOOGLE_CLOUD_PROJECT_ID=your_project_id
SESSION_ID=user_session_20250928
```

2. 获取 Google AI API Key：
   - 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
   - 创建新的 API Key
   - 复制到 `.env` 文件中

### 运行项目

```bash
python main.py
```

## 📁 项目结构

```
Agent-and-Wolf/
├── main.py                    # 主程序文件
├── books/                     # 小说文本文件
│   └── spice_and_wolf.txt    # 《狼与香辛料》文本
├── db/                        # 向量数据库存储
│   └── spice_and_wolf_db/    # Chroma 数据库文件
├── .env                       # 环境变量配置
├── .gitignore                
└── README.md
```

## 🎪 使用示例

### 基础对话
```
您: 你好,请问你是谁?


> Entering new AgentExecutor chain...
Thought
用户在问奴家是谁。这可是个展现咱贤狼风范的好机会呗。奴家得好好介绍一下自己，让汝明白咱可不是什么普通的小姑娘。

首先，要点明咱的身份——贤狼赫萝。
其次，要强调咱与众不同的地方，也就是咱引以为傲的耳朵和尾巴。
然后，可以用咱独特的说话方式，比如“奴家”、“汝”、“呗”来回答。
最后，可以稍微提一下咱的旅伴，那个笨蛋商人，来增加一点亲切感。

嗯，就这样决定了。不需要什么工具，咱的智慧就足够回答这个问题了。
Final Answer:哦？汝在问奴家是谁吗？

咱可是来自遥远北国约伊兹的贤狼赫萝。汝瞧瞧，这漂亮的耳朵和咱引以为傲的尾巴，可不是什么寻常装饰品呐。

现在，奴家正和某个傻瓜商人一起旅行，顺便帮他解决些麻烦事。汝可要好好记住咱的名字，这可是智慧的象征呗。

> Finished chain.
赫萝: 哦？汝在问奴家是谁吗？

咱可是来自遥远北国约伊兹的贤狼赫萝。汝瞧瞧，这漂亮的耳朵和咱引以为傲的尾巴，可不是什么寻常装饰品呐。

现在，奴家正和某个傻瓜商人一起旅行，顺便帮他解决些麻烦事。汝可要好好记住咱的名字，这可是智慧的象征呗。
```

### 记忆能力展示
```
您: 我刚才问了什么来着?


> Entering new AgentExecutor chain...
Thought: 呵呵，这个人类还真是健忘呐。咱不过是刚报上名号，他就忘了自己问了什么。这可真像咱认识的那个傻瓜商人。咱得好好调侃他一番才行。咱记得清清楚楚，他方才问的是奴家是谁。
Final Answer: 呵呵，汝这记性可真是有趣呐。才一转眼的工夫，就把自己的话给忘了？

汝方才问的，不就是“奴家是谁”么。看来咱这贤狼赫萝的大名，得让汝多记几遍才行呗。

> Finished chain.
赫萝: 呵呵，汝这记性可真是有趣呐。才一转眼的工夫，就把自己的话给忘了？

汝方才问的，不就是“奴家是谁”么。看来咱这贤狼赫萝的大名，得让汝多记几遍才行呗。
```

### 工具调用展示
```
您: 现在几点了?


> Entering new AgentExecutor chain...
Thought: 汝问现在是什么时辰了？嗯……咱虽然对太阳的位置很敏感，但要说得精确，还是得借助一下人类的玩意儿呗。让咱瞧瞧。
Action: Time
Action Input: {}2025年09月28日 星期日 下午10点51分16秒喔，原来已经是这个时辰了。夜都深了，月亮也该高高挂起了吧。是时候该找点宵夜，比如甜甜的蜂蜜酒配上苹果干了。得把这个时间告诉汝才行。
Final Answer: 汝问现在是什么时辰？咱瞧瞧……已经是深夜了呗。具体来说，是晚上10点51分左右。这么晚了还不睡，是想和咱一起偷吃苹果么？呵呵。

> Finished chain.
赫萝: 汝问现在是什么时辰？咱瞧瞧……已经是深夜了呗。具体来说，是晚上10点51分左右。这么晚了还不睡，是想和咱一起偷吃苹果么？呵呵。

您: 你知道叶玉如是谁吗?


> Entering new AgentExecutor chain...
Thought: 汝问的这个人名，奴家听着很陌生呐。这可不是咱熟悉的商人或者贵族的名字。看来，这又是汝等世界里的事情了。为了满足汝的好奇心，也为了不堕了咱贤狼的名头，咱就勉为其难地查一查呗。
Action: Wikipedia
Action Input: 叶玉如朱葉玉如，SBS，MH，JP（英語：Nancy Chu Ip Yuk-yu，1955年7月30日—），學術著作常以葉玉如（英語：Nancy Y. Ip）之名出版，生于香港，香港神经生物学家，現任香港科技大学校長兼生命科學部講座教授，前香港科技大学副校長（研究及發展）、晨興生命科學教授及分子神經科學國家重點實驗室主任、前理学院院长。中国科学院院士，美国国家科学院外籍院士，美国文理科学院院士。現任港區全國人大代表。唔，原来是位了不起的学者大人呐，还是什么大学的校长。研究的是“神经生物学”，听起来就是个很深奥、很需要智慧的学问，跟咱贤狼的智慧倒是有几分相似之处。不过，她可没有咱这般漂亮的尾巴就是了。咱已经知道该怎么回答了。
Final Answer: 哼哼，汝说的这个“叶玉如”，咱倒是稍微打听了一下。原来是汝等世界里一位相当有名的学者大人，还是什么大学的校长，研究着深奥的学问。听起来是个充满智慧的人物，不过，再怎么聪明，恐怕也比不上活了几百年的咱吧？毕竟，咱的智慧可是连麦子都能丰收的智慧呐。呵呵。

> Finished chain.
赫萝: 哼哼，汝说的这个“叶玉如”，咱倒是稍微打听了一下。原来是汝等世界里一位相当有名的学者大人，还是什么大学的校长，研究着深奥的学问。听起来是个充满智慧的人物，不过，再怎么聪明，恐怕也比不上活了几百年的咱吧？毕竟，咱的智慧可是连麦子都能丰收的智慧呐。呵呵。
```

### 小说内容查询
```
您: 毒小麦事件的结局是什么?


> Entering new AgentExecutor chain...
Question: 毒小麦事件的结局是什么?
Thought: 呵呵，汝问起那件事啦？那可是咱和那个傻瓜商人旅途中一次有趣的经历呐。咱得好好回想一下，然后用咱贤狼的口吻告诉汝。
这件事的核心是，一个叫杰廉的家伙散布谣言说某个产地的小麦有毒，想借此压低价格再大量买进。而咱家的傻瓜罗伦斯正好在那之前买了一大批那种小麦，眼看就要赔个精光。
要解决这个问题，光是澄清小麦没毒是没用的，商人们不会轻易相信。所以，咱就想出了一个更高明的法子。
哼哼，既然他们能造一个坏谣言，咱为什么不能造一个更好的谣言呢？
最后，咱在一个关键人物面前，稍微显露了一下咱的真本事……也就是，让对方相信这批小麦受到了狼神（也就是咱）的祝福，是能带来丰收的“福麦”。
这么一来，原本没人要的“毒小麦”，一下子就成了人人争抢的宝贝。
所以，结局就是……
Action: Query Database
Action Input: 毒小麦事件的结局，赫萝如何解决危机，罗伦斯赚了多少钱{'input': '毒小麦事件的结局，赫萝如何解决危机，罗伦斯赚了多少钱', 'chat_history': [], 'context': [Document(id='9b95518b-6fb0-4321-8102-2f369f9800c5', metadata={'source': 'spice_and_wolf.txt'}, page_content='不久后，茎干上端长出了新的麦穗，当麦穗变得沉甸甸时，青青麦草也变成了茶色。\n\n    这一连串的过程，在极其短暂的时间内就完成了。\n\n    转眼间，赫萝手上就长出了一根麦子。\n\n    「大概只能做到这般程度呗，而且不能一次做太多。还有呐……」\n\n    赫萝拿起手掌心上的麦子，一边在罗伦斯的鼻子前用麦穗前端搔痒，一边说：\n\n    「咱的这个也藏有种子。」\n\n    「我就是想笑，也只能苦笑。」\n\n    赫萝听了，一脸不悦地把麦子塞给罗伦斯说：\n\n    「那，不行吗?说到眼睛看得到的东西，顶多只有这个，还有原本的狼模样而已。」\n\n    「不，这样就够了。」\n\n    罗伦斯从赫萝手中接下麦子，继续说：\n\n    「再来就只剩下艾莉莎肯不肯接受这个计划而已。还有……」\n\n    「还有吗?」\n\n    罗伦斯点点头后，说了句「不过……」并摇摇头。\n\n    「到时就轮到我展现商人的手腕。我想，应该没问题吧。」\n\n    在分辨出恩贝尔送还的麦子当中哪些是毒麦，哪些不是毒麦，而且让村民们相信后，并不代表特列欧村就能够当场摆脱危机。\n\n    照塞姆村长的概算结果来说，不足的金额约莫七十利马。\n\n    特列欧必须设法解决金额不足的问题，否则就将成为恩贝尔的掠食对象。\n\n    然而，如果恩贝尔一开始就是为了支配特列欧才在麦子里下毒，就算恩贝尔认同了奇迹，并接受毒麦的辨别结果，也不可能买回送还的麦子。\n\n    这么一来，就表示必须设法把送还的麦子变卖成现金。\n\n    不过，如果能够让问题发展到这般地步，那就是商人的领域了。\n\n    而罗伦斯正是商人。\n\n    「好，那这样我们回去吧。」\n\n    「嗯，咱也快要冷得受不了了。」\n\n    赫萝笑着站起身子，跟着啪唰一声，甩动尾巴遮住了罗伦斯的视线。转眼问赫萝就变回了狼的模样。\n\n    『汝好像觉得很可惜的样子呐?』\n\n    赫萝露出尖牙说道，罗伦斯耸耸肩回答说：\n\n    「你倒是很开心的样子呢。」\n\n    赫萝与罗伦斯很快就追上了艾莉莎与艾凡。\n\n    在过了正午不久后，一行人便抵达了特列欧。\n\n    出乎意料地，艾莉莎一下子就接受了罗伦斯两人的提议。\n\n    或许艾莉莎心里明白，如果找不到手段，光有决心也无济于事。'), Document(id='14ebbe63-d1e7-45dc-ac94-c61ec5a36a29', metadata={'source': 'spice_and_wolf.txt'}, page_content='「问题在于毒麦是呗?如果是混在其中，咱有办法分辨。」\n\n    「我也想过这个可能性了。不过，我想还是没用。」\n\n    「无法让人们相信是呗……」\n\n    「除非有奇迹发生。」\n\n    罗伦斯说道，然后再说了一遍：\n\n    「……除非有奇迹发生?」\n\n    「怎么着?」\n\n    罗伦斯以令人头昏眼花的速度移动视线，试图将脑中的思绪衔接起来。\n\n    罗伦斯曾想过赫萝能够分辨麦子的可能性。当时使得思绪碰壁的问题是，如何让人们相信麦子是否有毒。\n\n    不过，罗伦斯隐约记得有听闻过类似的话题。\n\n    到底是什么?\n\n    各种记忆在罗伦斯的脑海里唰唰唰地一闪过。\n\n    最后浮现了教会与艾莉莎的身影。\n\n    「对啊，奇迹啊。」\n\n    「唔?」\n\n    「你猜猜，什么方法能让教会有效地增加信徒?」\n\n    赫萝露出感到有些被瞧不起的表情，不甘愿地回答说：\n\n    「创造奇迹吗?」\n\n    「没错。但是大部分的奇迹，都像果实里藏有种子一样藏有秘密。」\n\n    这会儿换成是赫萝快速移动着视线。\n\n    「如果是要眼睛看得到的东西，就是……汝啊，咱的麦子在哪?」\n\n    罗伦斯指向被赫萝推倒而飞到后方的行李。\n\n    「汝伸手帮咱拿。」\n\n    赫萝似乎没有从罗伦斯的膝盖上挪开身子的打算。\n\n    罗伦斯心想抗议也没用，于是听话地扭转身体，伸手把行李拉近自己，然后取出装有赫萝寄宿其中的麦子的小袋子。\n\n    「拿去。」\n\n    「嗯，汝睁大眼睛看好呐。」\n\n    赫萝从小袋子里取出一粒麦子，放在手掌心上，跟着轻轻深呼吸一口气。\n\n    然后，在下一个瞬间——\n\n    「这!」\n\n    罗伦斯才发现眼前微微颤动的麦粒突然裂开，跟着就看见麦粒发出绿芽、长出白色根茎，叶片也随之拉大，茎干朝向天际迅速伸展。\n\n    不久后，茎干上端长出了新的麦穗，当麦穗变得沉甸甸时，青青麦草也变成了茶色。\n\n    这一连串的过程，在极其短暂的时间内就完成了。\n\n    转眼间，赫萝手上就长出了一根麦子。\n\n    「大概只能做到这般程度呗，而且不能一次做太多。还有呐……」\n\n    赫萝拿起手掌心上的麦子，一边在罗伦斯的鼻子前用麦穗前端搔痒，一边说：\n\n    「咱的这个也藏有种子。」'), Document(id='def29c9a-505b-4c94-8ace-7ae7e731aa58', metadata={'source': 'spice_and_wolf.txt'}, page_content='罗伦斯一边想着这些事情，一边打开旅馆房间的房门，猛然扑鼻而来的酒臭味让他不禁皱起了眉头。\n\n    “原来有这么臭啊……”\n\n    罗伦斯暗自后悔起出门前没有好好漱口，但又想到这臭味多半是仍在睡梦中的狼造成的。\n\n    尽管罗伦斯走进了房间，赫萝仍然没有要起床的意思。不过，罗伦斯听见赫萝像平时一样发出少根筋的鼾声，心想或许赫萝的宿醉好多了吧。\n\n    房间里的酒臭味实在太浓，于是罗伦斯先打开木窗，再走近床边。他发现搁在床边的水壶已见了底，而桶子——幸好仍是干净的。露出棉被外的脸蛋已恢复了血色。罗伦斯心想没买下甜蜂蜜饼干，而改买鲜少购买的小麦面包是个正确的决定。\n\n    赫萝如果醒来，肯定一开口就会说肚子饿了。\n\n    罗伦斯把手上装有小麦面包的麻袋凑近赫萝的鼻子，小小的鼻子便微微颤动。有别于又硬又苦的黑麦或燕麦面包，香甜柔软的小麦面包散发出来的香味，闻起来可口极了。\n\n    赫萝不停嗅着味道，那模样让人怀疑起她是否仍睡着。不久后，赫萝发出“呼啊”一声，跟着把脸埋进棉被底下。\n\n    罗伦斯把视线移向赫萝的脚边，他看见露出棉被外的尾巴哆嗦着。\n\n    想必赫萝是打了个大哈欠吧。\n\n    罗伦斯稍事等待后，果然看见泪眼婆娑的赫萝从棉被底下探出头来。\n\n    “嗯……好像闻到很香的味道……”\n\n    “感觉好点没？”\n\n    赫萝揉揉眼睛，再次打了个哈欠，然后像在自言自语似地回答说：\n\n    “……肚子饿了。”\n\n    罗伦斯按捺不住地笑了出来。\n\n    不过，赫萝一副不感兴趣的模样坐起身子，并再打了一次哈欠。然后，赫萝用鼻子哼了几声，视线随即不客气地看向罗伦斯手中的麻袋。\n\n    “我就知道你会这么说，所以豁出去买了小麦面包回来。”\n\n    罗伦斯一递出整个麻袋，品格高尚的贤狼当场变成了与面包玩耍的小猫。\n\n    “汝不吃吗？”\n\n    赫萝坐在床边一边抱着麻袋，一边贪婪地吃着雪白小麦面包的模样，怎么看也不像拥有宽怀心胸、愿意把袋中物分给别人的样子。\n\n    再说，赫萝口中虽然这么说，但是她的眼神却跟保护猎物不被偷走的猎犬没两样。\n\n    赫萝在吃光面包之前先这么询问，应该是她好不容易才做到的体贴吧。\n\n    “嗯，不用，我刚刚先试吃了。”'), Document(id='199e3c39-28d1-490f-8bfd-621da42b4f1d', metadata={'source': 'spice_and_wolf.txt'}, page_content='「当我们来到这个村子时，大概就已经被村民怀疑我们在麦子里下毒。因为把灾难带到村子的恶魔总是从村外出现。」\n\n    「而且，咱们也无法用言语解释自己的清白，是呗。」\n\n    罗伦斯点了点头。\n\n    当发生灾难时，不管毒麦是恶魔带来的，或是有人恶意下的毒，人们都会想得知造成灾难的原因。\n\n    并非做了坏事的存在是恶魔，而是有坏事发生时，人们才会说是恶魔出现。\n\n    「这状况实在太刚好了，怎么想都觉得这是恩贝尔为了控制特列欧村采取的手段。况且，只要是这一带地区的诸侯，想必都知道恩贝尔和特列欧正为了税金等问题而斗争着。如果这时意外发现特列欧的麦子里有毒，无论是谁都会怀疑是恩贝尔自导自演。这么一来，因为特列欧村有后盾存在，所以后盾们不可能不吭声。在这样的状况下，恩贝尔需要一个替死鬼。而我们就是在毫不知情的状况下，刚好在这个时候来到这里的商人，所以恩贝尔刚好可以如愿地执行计划。」\n\n    这么一来，大致猜得出来恩贝尔会在最后设下什么样的陷阱。\n\n    「然后，恩贝尔在与特列欧交涉时，想必会提出气只要你们找出在麦子里下毒的凶手，就答应让你们晚点还钱』的条件。」\n\n    恩贝尔不仅能够向周遭主张这不是他们自导自演的骚动，还能够将特列欧纳为已有，而罗伦斯等人则因为城镇的贪婪欲望，而化为断头台上的露水蒸发。\n\n    「恩贝尔应该也不愿意和我们公会起冲突，所以当然不会为我们的清白与否开庭审判。恩贝尔一定会早早将我们定罪，好送上断头台，然后他们大概会和特列欧的村民说气只要村民不泄露我们的身分，就愿意少收一些借款』吧，这样事情就可以完美地落幕。」\n\n    赫萝叹了口气，咬了咬大拇指的指甲。\n\n    「汝甘愿这样遭人陷害吗?」\n\n    「怎么可能。」\n\n    虽然罗伦斯耸耸肩，不由得用鼻子轻笑。但如果问他该怎么化解窘境，他也不知该怎么做。\n\n    「若是逃跑会变成咱们是畏罪潜逃。汝的人头画像如果被四处张贴，就不能继续做生意。」\n\n    「我的商人生涯也就彻彻底底地结束。」\n\n    该怎么办才好?\n\n    就在罗伦斯这么想着时，赫萝像是察觉到什么事情似的插嘴说：\n\n    「唔。对了，不能向汝所属的那个什么公会求救吗?」\n\n    「求救……啊?如果可以……啊，对喔……」\n\n    罗伦斯叩叩叩地敲着自己的脑袋，赫萝露出怀疑的眼光直盯着他看。'), Document(id='ad3b5c7e-b760-47fe-a833-c1287550c115', metadata={'source': 'spice_and_wolf.txt'}, page_content='「世上真的有很多事情都无法如愿呢。」\n\n    罗伦斯一阖上书本，赫萝便咬着尾巴前端，然后夹杂着叹息声回答了句：「就是呐。」\n\n    「那么，这村子那些无法如愿的家伙打算怎么做呐?汝如果决定要逃跑，就赶快搞定呗，毕竟还是趁夜逃跑比较理想呐。」\n\n    「关于我们的命运，艾莉莎的推论和我的想法都一样。这么一来，当然是三十六计走为上策，对吧?」\n\n    「真是笨人想不出好主意来呐。」\n\n    赫萝一边「呼」的一声打了个哈欠，一边说道，跟着站了起来。\n\n    「不过这么一来，汝这次可亏损大了呐。」\n\n    「这也是没办法的事啊，又没办法带走小麦。」\n\n    「汝这次倒是没有表现得慌张呐。」\n\n    「是吗?」\n\n    罗伦斯摸着下巴说道，他并非第一次牵扯进这类纠纷。身为商人，有时难免会碰上无法挽救的损失。\n\n    虽然罗伦斯没显得慌张，当然也是拜他在卡梅尔森赚了一笔出乎预期的利益所赐。但是对于自己能够如此镇静，就是罗伦斯本人都觉得讶异。\n\n    况且，在村落这种封闭的地方，旅人的性命是非常不值钱的东西。罗伦斯觉得光是知道没有性命危险，就算是赚够了本。\n\n    「不过，如果是能够带着走的高价商品，即使在现在这种状况下，也有办法挽救吧。」\n\n    「好比说之前卖过的胡椒，是呗?」\n\n    当然很多商人都会有同样的想法，而且因为胡椒等辛香料非常稀少，所以价位非常高。只不过如果进不到货，当然就没得运送。\n\n    罗伦斯想到这里时，脑海中忽然浮现一个念头：\n\n    「不过，有一种高价品比辛香料更轻盈，而且能够带着走。」\n\n    「喔?」\n\n    「那就是信任。」\n\n    赫萝难得露出感到佩服的表情，然后坏心眼地笑着说：\n\n    「就等到汝对咱的信任度变高，再脱手卖出好了。」\n\n    「你知不知道我因为被你过度捉弄，变得疑神疑鬼的?」\n\n    赫萝以喉咙发出咯咯笑声后，用她的手臂轻轻勾住罗伦斯的右手臂说：\n\n    「那么，咱得设法挽回呐。」\n\n    「你不知道就是因为你这种态度，才让我变得疑神疑鬼的吗?」\n\n    然而，赫萝却是丝毫不动摇，她眯起眼睛喃喃说：\n\n    「当心说谎会减低信任度。」\n\n    罗伦斯只能用「狡猾」两字来形容赫萝。\n\n    「不过，汝没有责怪过咱半句，咱真的觉得高兴。」\n\n    「咦?」')], 'answer': '**毒小麦事件的结局：**\n提供的文档并未描述毒小麦事件的最终结局，只提到艾莉莎出乎意料地接受了罗伦斯和赫萝的提议。罗伦斯表示接下来的财务问题将由他以商人的手腕来解决。\n\n**赫萝如何解决危机：**\n赫萝通过展示她能在一瞬间让麦粒发芽、生长并结出新麦穗的“奇迹”，来解决如何让人们相信她能分辨毒麦的问题。\n\n**罗伦斯赚了多少钱：**\n提供的文档中没有提及罗伦斯在此事件中赚了多少钱。文档只提到村子有约七十利马的资金缺口需要解决，罗伦斯计划通过变卖送还的麦子来弥补。'}哼哼，咱记得很清楚嘛。数据库里的信息虽然零散，但也把关键点都提到了。咱来好好整理一下，用咱的语气说出来呗。
首先，咱家那个傻瓜商人差点就因为毒小麦的谣言亏得血本无归，还可能被当成替罪羊。
接着，咱想到了一个绝妙的主意。既然他们能散布“毒小麦”的坏消息，咱就能创造一个“福麦”的好消息。
咱当着关键人物的面，稍微展示了一下咱贤狼的力量——让麦粒瞬间发芽结穗。这可不是什么魔术，而是咱身为丰收之狼的本事呐。他们把这当成了“奇迹”，一下子就相信这批小麦受到了神的祝福。
于是乎，原本人人避之不及的“毒小麦”，转眼间就成了能带来丰收的“福麦”，价格自然也水涨船高。
至于那个傻瓜罗伦斯赚了多少钱嘛……呵呵，商人的账本咱可没细看，不过他不仅没亏钱，还小赚了一笔，最重要的是保住了小命和商人的信誉。这可全都多亏了咱这位贤狼的智慧呐。
所以，结局就是咱用智慧把一场危机变成了商机，顺便还捉弄了一下那些自作聪明的家伙呗。
Final Answer: 呵呵，汝问起那件麻烦事啦？那可是咱和那个傻瓜商人旅途中一次挺有趣的经历呐。

简单来说，有人想用“毒小麦”的谣言来害咱家的罗伦斯，让他血本无归。可他们也不想想，咱是谁？咱可是贤狼赫萝呗。

咱就将计就计，稍微显露了一下咱丰收之狼的本事，让他们相信那批小麦是受到咱祝福的“福麦”。这么一来，原本没人要的麦子，一下子就成了人人争抢的宝贝。

结局嘛，自然是皆大欢喜。那个傻瓜不仅没亏钱，还小赚了一笔，最重要的是保住了小命。这一切，当然都得归功于咱这颗聪明的脑袋呐。呵呵呵。

> Finished chain.
赫萝: 呵呵，汝问起那件麻烦事啦？那可是咱和那个傻瓜商人旅途中一次挺有趣的经历呐。

简单来说，有人想用“毒小麦”的谣言来害咱家的罗伦斯，让他血本无归。可他们也不想想，咱是谁？咱可是贤狼赫萝呗。

咱就将计就计，稍微显露了一下咱丰收之狼的本事，让他们相信那批小麦是受到咱祝福的“福麦”。这么一来，原本没人要的麦子，一下子就成了人人争抢的宝贝。

结局嘛，自然是皆大欢喜。那个傻瓜不仅没亏钱，还小赚了一笔，最重要的是保住了小命。这一切，当然都得归功于咱这颗聪明的脑袋呐。呵呵呵。
```

## 🔧 技术特性

### ReAct Agent 架构
- **思考 (Thought)**: 分析用户问题，制定解答策略
- **行动 (Action)**: 选择合适的工具获取信息
- **观察 (Observation)**: 处理工具返回的结果
- **最终回答**: 以赫萝的风格整合信息并回应

### 集成工具
1. **🕒 Time Tool**: 获取当前日期时间，支持中文格式化
2. **📚 Wikipedia Tool**: 搜索中文维基百科，获取实时知识
3. **💾 Query Database Tool**: 检索《狼与香辛料》小说内容

### RAG 系统
- **文档切分**: 1000字符块大小，200字符重叠
- **向量化**: Qwen3-Embedding-0.6B 中文嵌入模型
- **检索策略**: 相似度阈值搜索，返回前5个最相关片段
- **上下文感知**: 基于聊天历史的智能检索

### 记忆管理
- **本地记忆**: 单次会话的上下文管理
- **云端持久化**: Google Firestore 存储聊天历史
- **历史感知**: 理解对话中的指代关系

## 🎯 项目亮点

1. **🎪 沉浸式角色扮演**: 完美还原赫萝的语言特色和性格
2. **🧠 智能推理**: 基于 ReAct 框架的逻辑推理能力
3. **📖 深度内容理解**: 准确回答小说相关问题
4. **⚡ 实时信息获取**: 集成多种外部数据源
5. **💾 持久化记忆**: 跨会话的聊天历史保持

## 🛠️ 开发计划

- [ ] **Web 界面**: 基于 Streamlit/FastAPI 的 Web UI
- [ ] **语音对话**: 文字转语音和语音识别功能  
- [ ] **更多工具**: 天气查询、新闻搜索、图像生成等
- [ ] **角色扩展**: 支持罗伦斯等其他角色
- [ ] **多语言支持**: 英文、日文版本

## ⚠️ 注意事项

1. **API 费用**: Google Gemini API 按使用量计费，请注意控制成本
2. **网络要求**: 需要访问 Google AI、Wikipedia 等服务
3. **存储空间**: 向量数据库会占用一定磁盘空间
4. **模型限制**: 嵌入模型在 Apple Silicon 设备上使用 MPS 加速

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置
1. Fork 项目并 clone 到本地
2. 创建虚拟环境并安装依赖
3. 配置 `.env` 文件
4. 运行测试确保功能正常

### 贡献方式
- 🐛 报告 Bug
- 💡 提出新功能建议  
- 📝 改进文档
- 🔧 提交代码优化

## 📄 许可证

本项目仅用于学习和研究目的。请遵守相关版权法律，不得用于商业用途。

## 🙏 致谢

- **支仓冻砂老师**: 创作了精彩的《狼与香辛料》小说
- **LangChain 社区**: 提供优秀的 AI 应用开发框架
- **Google**: 提供强大的 Gemini 大语言模型
- **开源社区**: 各种优秀的工具和库

---

> *"汝要记住，咱可是贤狼赫萝呗！"* 🐺✨

**如果觉得这个项目有趣，请给个 ⭐ Star 支持一下！**